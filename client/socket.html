<html>
  <head>
    <title>game game</title>
  </head>
  <body>
    <div>game game</div>

    <br />
    <div>
      self info:
      <div id="self-info"></div>
    </div>

    <br />
    <div>
      broadcast info:
      <div id="broadcast-info"></div>
    </div>

    <script>
      const PORT = 2000;
      const SELF = 'SELF';
      const BROADCAST = 'BROADCAST';
      const PING = 57;
      const PONG = new Uint8Array(['A'.charCodeAt()]);

      const socket = new WebSocket(`ws://localhost:${PORT}`);
      socket.binaryType = 'arraybuffer';

      socket.onopen = (event) => {
        console.log('-- on open');
      };

      socket.onerror = (err) => {
        console.error(err);
      };

      socket.onclose = (event) => {
        console.log('-- on close');
      };

      socket.onmessage = (event) => {
        const data = event.data;

        // server ping me(client), me pong server.
        if (typeof data !== 'string') {
          // transform to UInt8Array
          let buffer = new Uint8Array(data);

          if (buffer.length === 1 && buffer[0] === PING) {
            socket.send(PONG);
            return;
          }
        }

        const [messageType, restData] = data.split('::');
        console.log('messagetype', messageType);
        console.log('restData', restData);

        if (messageType === SELF) {
          const selfInfo = restData;
          document.getElementById('self-info').innerHTML = selfInfo;
          return;
        } else if (messageType === BROADCAST) {
          const broadcastInfo = restData;
          document.getElementById('broadcast-info').innerHTML = broadcastInfo;
          return;
        }
      };
    </script>
  </body>
</html>
